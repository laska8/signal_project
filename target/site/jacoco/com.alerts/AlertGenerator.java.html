<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AlertGenerator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">cardio_generator</a> &gt; <a href="index.source.html" class="el_package">com.alerts</a> &gt; <span class="el_source">AlertGenerator.java</span></div><h1>AlertGenerator.java</h1><pre class="source lang-java linenums">package com.alerts;

import com.data_management.DataStorage;
import com.data_management.Patient;
import com.data_management.PatientRecord;

import java.util.ArrayList;
import java.util.List;

/**
 * The {@code AlertGenerator} class is responsible for monitoring patient data
 * and generating alerts when certain predefined conditions are met. This class
 * relies on a {@link DataStorage} instance to access patient data and evaluate
 * it against specific health criteria.
 */
public class AlertGenerator {
    private DataStorage dataStorage;


    /**
     * Constructs an {@code AlertGenerator} with a specified {@code DataStorage}.
     * The {@code DataStorage} is used to retrieve patient data that this class
     * will monitor and evaluate.
     *
     * @param dataStorage the data storage system that provides access to patient
     *                    data
     */
<span class="fc" id="L28">    public AlertGenerator(DataStorage dataStorage) {</span>
<span class="fc" id="L29">        this.dataStorage = dataStorage;</span>

<span class="fc" id="L31">    }</span>

    /**
     * Evaluates the specified patient's data to determine if any alert conditions
     * are met. If a condition is met, an alert is triggered via the
     * {@link #triggerAlert}
     * method. This method should define the specific conditions under which an
     * alert
     * will be triggered.
     *
     * @param patient the patient data to evaluate for alert conditions
     */
    public void evaluateData(Patient patient) {
        // Implementation goes here
<span class="fc bfc" id="L45" title="All 2 branches covered.">        if (patient == null) {</span>
<span class="fc" id="L46">            throw new NullPointerException(&quot;Patient data is null.&quot;);</span>
        }
<span class="fc" id="L48">        checkSystolicPressure(patient);</span>
<span class="fc" id="L49">        checkDiastolicPressure(patient);</span>
<span class="fc" id="L50">        checkBloodPressureIncreasing(patient);</span>
<span class="fc" id="L51">        checkBloodPressureDecreasing(patient);</span>
<span class="fc" id="L52">        checkLowSaturation(patient);</span>
<span class="fc" id="L53">        checkRapidDrop(patient);</span>
<span class="fc" id="L54">        checkHeartRate(patient);</span>
<span class="fc" id="L55">        irregularBeat(patient);</span>
<span class="fc" id="L56">        hypotensiveHypoxemiaAlert(patient);</span>
<span class="fc" id="L57">    }</span>


    /**
     * This method checks for hypotensive hypoxemia conditions in the patient's records and triggers an alert
     * if both blood pressure and blood oxygen saturation are below certain thresholds.
     * @param patient
     */
    public boolean hypotensiveHypoxemiaAlert(Patient patient) {
<span class="fc" id="L66">        long currentTime = System.currentTimeMillis();</span>
<span class="fc" id="L67">        boolean bloodPressure = false;</span>
<span class="fc" id="L68">        boolean bloodOxygenSaturation = false;</span>
<span class="fc bfc" id="L69" title="All 2 branches covered.">        for (int i = 0; i &lt; patient.patientRecords.size();i++){</span>
<span class="fc" id="L70">            PatientRecord record = patient.patientRecords.get(i);</span>
<span class="fc bfc" id="L71" title="All 4 branches covered.">            if (&quot;SystolicPressure&quot;.equals(record.getRecordType()) &amp;&amp; record.getMeasurementValue() &lt; 90) {</span>
<span class="fc" id="L72">                bloodPressure = true;</span>
            }
<span class="fc bfc" id="L74" title="All 4 branches covered.">            if (&quot;Saturation&quot;.equals(record.getRecordType()) &amp;&amp; record.getMeasurementValue() &lt; 92) {</span>
<span class="fc" id="L75">                bloodOxygenSaturation = true;</span>
            }
<span class="pc bpc" id="L77" title="1 of 4 branches missed.">            if (bloodPressure &amp;&amp; bloodOxygenSaturation) {</span>
<span class="fc" id="L78">                triggerAlert(new Alert(Integer.toString(record.getPatientId()), &quot;Hypotensive Hypoxemia Alert&quot;, currentTime));</span>
<span class="fc" id="L79">                return true;</span>
            }
        }
<span class="fc" id="L82">        return false;</span>
    }

    /**
     * This method checks the systolic blood pressure of the patient and triggers an alert if it falls outside the normal range.
     * @param patient
     */
    public boolean checkSystolicPressure(Patient patient){
<span class="fc" id="L90">        boolean trigger = false;</span>

<span class="fc bfc" id="L92" title="All 2 branches covered.">        for(int i=0; i&lt;patient.patientRecords.size(); i++) {</span>
<span class="fc" id="L93">            PatientRecord rec = patient.patientRecords.get(i);</span>

<span class="fc bfc" id="L95" title="All 2 branches covered.">            if (rec.getRecordType().equals(&quot;SystolicPressure&quot;)) {</span>
<span class="pc bpc" id="L96" title="1 of 4 branches missed.">                if (rec.getMeasurementValue() &gt;= 180 || rec.getMeasurementValue() &lt;= 90) {</span>
<span class="fc" id="L97">                    String id = String.valueOf(rec.getPatientId());</span>
<span class="fc" id="L98">                    Alert systolic = new Alert(id, rec.getRecordType(), rec.getTimestamp());</span>
<span class="fc" id="L99">                    triggerAlert(systolic);</span>
<span class="fc" id="L100">                    trigger=true;</span>
                }
            }
        }
<span class="fc" id="L104">        return trigger;</span>
    }

    /**
     * This method checks the diastolic blood pressure of the patient and triggers an alert if it falls outside the normal range.
     * @param patient
     */
    public boolean checkDiastolicPressure(Patient patient){
<span class="fc" id="L112">        boolean trigger = false;</span>

<span class="fc bfc" id="L114" title="All 2 branches covered.">        for(int i=0; i&lt;patient.patientRecords.size(); i++) {</span>
<span class="fc" id="L115">            PatientRecord rec = patient.patientRecords.get(i);</span>

<span class="fc bfc" id="L117" title="All 2 branches covered.">            if (rec.getRecordType().equals(&quot;DiastolicPressure&quot;)) {</span>
<span class="pc bpc" id="L118" title="1 of 4 branches missed.">                if (rec.getMeasurementValue() &gt;= 120 || rec.getMeasurementValue() &lt;= 60) {</span>
<span class="fc" id="L119">                    String id = String.valueOf(rec.getPatientId());</span>
<span class="fc" id="L120">                    Alert diastolic = new Alert(id, rec.getRecordType(), rec.getTimestamp());</span>
<span class="fc" id="L121">                    triggerAlert(diastolic);</span>
<span class="fc" id="L122">                    trigger=true;</span>
                }
            }
        }

<span class="fc" id="L127">        return trigger;</span>
    }

    /**
     * This method checks for significant increases in the patient's blood pressure over three consecutive readings
     * and triggers an alert if such increases are detected.
     * @param patient
     */
    public boolean checkBloodPressureIncreasing(Patient patient){
<span class="fc" id="L136">        boolean trigger = false;</span>
<span class="fc" id="L137">        PatientRecord previous=patient.patientRecords.get(0);</span>
<span class="fc" id="L138">        int count=0;</span>

<span class="pc bpc" id="L140" title="1 of 4 branches missed.">        for(int i = 0; i&lt;patient.patientRecords.size() &amp;&amp; !trigger; i++) {</span>
<span class="fc" id="L141">            PatientRecord rec = patient.patientRecords.get(i);</span>

<span class="pc bpc" id="L143" title="1 of 4 branches missed.">            if(rec.getRecordType().equals(&quot;SystolicPressure&quot;) || rec.getRecordType().equals(&quot;DiastolicPressure&quot;)){</span>

<span class="fc bfc" id="L145" title="All 2 branches covered.">                if(count==0){</span>
<span class="fc" id="L146">                    count++;</span>
<span class="fc" id="L147">                    previous=rec;</span>
                } else {
<span class="fc bfc" id="L149" title="All 2 branches covered.">                    if (Math.abs(previous.getMeasurementValue() - rec.getMeasurementValue()) &gt;= 10</span>
<span class="pc bpc" id="L150" title="1 of 2 branches missed.">                            &amp;&amp; previous.getMeasurementValue()&lt;rec.getMeasurementValue()) {</span>
<span class="fc" id="L151">                        count++;</span>
<span class="fc" id="L152">                        previous = rec;</span>
                    } else {
<span class="fc" id="L154">                        count = 0;</span>
<span class="fc" id="L155">                        previous = rec;</span>
                    }
                }

<span class="fc bfc" id="L159" title="All 2 branches covered.">                if(count==3){</span>
<span class="fc" id="L160">                    String id = String.valueOf(rec.getPatientId());</span>
<span class="fc" id="L161">                    Alert bloodPressureIncrease = new Alert(id, rec.getRecordType(), rec.getTimestamp());</span>
<span class="fc" id="L162">                    triggerAlert(bloodPressureIncrease);</span>
<span class="fc" id="L163">                    trigger=true;</span>
<span class="fc" id="L164">                    count=0;</span>
<span class="fc" id="L165">                    previous=rec;</span>
                }
            }
        }

<span class="fc" id="L170">        return trigger;</span>
    }

    /**
     * This method checks for significant decreases in the patient's blood pressure over three consecutive readings
     * and triggers an alert if such decreases are detected.
     * @param patient
     */
    public boolean checkBloodPressureDecreasing(Patient patient){
<span class="fc" id="L179">        boolean trigger = false;</span>
<span class="fc" id="L180">        PatientRecord previous=patient.patientRecords.get(0);</span>
<span class="fc" id="L181">        int count=0;</span>

<span class="pc bpc" id="L183" title="1 of 4 branches missed.">        for(int i = 0; i&lt;patient.patientRecords.size() &amp;&amp; !trigger; i++) {</span>
<span class="fc" id="L184">            PatientRecord rec = patient.patientRecords.get(i);</span>

<span class="pc bpc" id="L186" title="1 of 4 branches missed.">            if(rec.getRecordType().equals(&quot;SystolicPressure&quot;) || rec.getRecordType().equals(&quot;DiastolicPressure&quot;)){</span>

<span class="fc bfc" id="L188" title="All 2 branches covered.">                if(count==0){</span>
<span class="fc" id="L189">                    count++;</span>
<span class="fc" id="L190">                    previous=rec;</span>
                } else {
<span class="fc bfc" id="L192" title="All 2 branches covered.">                    if (Math.abs(previous.getMeasurementValue() - rec.getMeasurementValue()) &gt;= 10</span>
<span class="pc bpc" id="L193" title="1 of 2 branches missed.">                            &amp;&amp; previous.getMeasurementValue()&gt;rec.getMeasurementValue()) {</span>
<span class="fc" id="L194">                        count++;</span>
<span class="fc" id="L195">                        previous = rec;</span>
                    } else {
<span class="fc" id="L197">                        count = 0;</span>
<span class="fc" id="L198">                        previous = rec;</span>
                    }
                }

<span class="fc bfc" id="L202" title="All 2 branches covered.">                if(count==3){</span>
<span class="fc" id="L203">                    String id = String.valueOf(rec.getPatientId());</span>
<span class="fc" id="L204">                    Alert bloodPressureDecrease = new Alert(id, rec.getRecordType(), rec.getTimestamp());</span>
<span class="fc" id="L205">                    triggerAlert(bloodPressureDecrease);</span>
<span class="fc" id="L206">                    trigger=true;</span>
<span class="fc" id="L207">                    count=0;</span>
<span class="fc" id="L208">                    previous=rec;</span>
                }
            }
        }

<span class="fc" id="L213">        return trigger;</span>
    }

    /**
     * This method checks for low blood oxygen saturation levels in the patient's records
     * and triggers an alert if it falls below a certain threshold.
     * @param patient
     */
    public boolean checkLowSaturation(Patient patient){
<span class="fc" id="L222">        boolean trigger = false;</span>

<span class="fc bfc" id="L224" title="All 2 branches covered.">        for(int i=0; i&lt;patient.patientRecords.size(); i++) {</span>
<span class="fc" id="L225">            PatientRecord rec = patient.patientRecords.get(i);</span>

<span class="fc bfc" id="L227" title="All 2 branches covered.">            if (rec.getRecordType().equals(&quot;Saturation&quot;)) {</span>
<span class="pc bpc" id="L228" title="1 of 2 branches missed.">                if (rec.getMeasurementValue() &lt;=92) {</span>
<span class="fc" id="L229">                    String id = String.valueOf(rec.getPatientId());</span>
<span class="fc" id="L230">                    Alert lowSaturation = new Alert(id, rec.getRecordType(), rec.getTimestamp());</span>
<span class="fc" id="L231">                    triggerAlert(lowSaturation);</span>
<span class="fc" id="L232">                    trigger=true;</span>
                }
            }
        }
<span class="fc" id="L236">        return trigger;</span>
    }

    /**
     * This method checks for rapid drops in blood oxygen saturation levels over 10 minutes or less
     * and triggers an alert if such drops are detected.
     * @param patient
     */
    public boolean checkRapidDrop(Patient patient){

<span class="fc" id="L246">        List&lt;Double&gt; timer=new ArrayList&lt;Double&gt;();</span>
<span class="fc" id="L247">        List&lt;Double&gt; values=new ArrayList&lt;Double&gt;();</span>
<span class="fc" id="L248">        double passedTime=0;</span>
<span class="fc" id="L249">        double sumDrops=0;</span>
<span class="fc" id="L250">        PatientRecord prev=patient.patientRecords.get(0);</span>
<span class="fc" id="L251">        boolean trigger = false;</span>

<span class="fc bfc" id="L253" title="All 2 branches covered.">        for(int i=1; i&lt;patient.patientRecords.size(); i++) {</span>
<span class="fc" id="L254">            PatientRecord rec = patient.patientRecords.get(i);</span>

<span class="pc bpc" id="L256" title="1 of 2 branches missed.">            if (rec.getRecordType().equals(&quot;Saturation&quot;)) {</span>

<span class="fc" id="L258">                double diffTime=rec.getTimestamp()- prev.getTimestamp();</span>
<span class="fc" id="L259">                passedTime=passedTime+ diffTime;</span>

<span class="fc" id="L261">                double diffMeasure=prev.getMeasurementValue()-rec.getMeasurementValue();</span>
<span class="fc" id="L262">                sumDrops=sumDrops+diffMeasure;</span>

<span class="fc bfc" id="L264" title="All 2 branches covered.">                if(sumDrops&lt;5){</span>

                    //in miliseconds
<span class="fc bfc" id="L267" title="All 4 branches covered.">                    if(passedTime&gt;=600000 &amp;&amp; i!=1){</span>

<span class="fc" id="L269">                        passedTime=0;</span>
<span class="fc" id="L270">                        sumDrops=0;</span>
                    }

<span class="fc" id="L273">                    timer.add(diffTime);</span>
<span class="fc" id="L274">                    values.add(diffMeasure);</span>

                } else{
<span class="fc" id="L277">                    String id = String.valueOf(rec.getPatientId());</span>
<span class="fc" id="L278">                    Alert rapidDrop = new Alert(id, rec.getRecordType(), rec.getTimestamp());</span>
<span class="fc" id="L279">                    triggerAlert(rapidDrop);</span>
<span class="fc" id="L280">                    trigger=true;</span>
                }

<span class="fc" id="L283">                prev=rec;</span>
            }
        }

<span class="fc" id="L287">        return trigger;</span>
    }

    /**
     * This method checks the patient's heart rate derived from ECG readings and triggers an alert if it falls outside the normal range.
     * @param patient
     */
    public boolean checkHeartRate(Patient patient){

<span class="fc" id="L296">        PatientRecord pr=patient.patientRecords.get(0);</span>
<span class="fc" id="L297">        boolean trigger = false;</span>

<span class="fc bfc" id="L299" title="All 2 branches covered.">        for(int i=0; i&lt;patient.patientRecords.size(); i++) {</span>
<span class="fc" id="L300">            PatientRecord rec = patient.patientRecords.get(i);</span>

<span class="pc bpc" id="L302" title="1 of 2 branches missed.">            if (rec.getRecordType().equals(&quot;ECG&quot;)) {</span>

                //transforming the data into bpm
                //double timeInterval=rec.getTimestamp()-pr.getTimestamp();
                //double heartRate=60000/timeInterval;

                //for testing JUnit
<span class="fc" id="L309">                double heartRate=rec.getMeasurementValue();</span>

<span class="pc bpc" id="L311" title="1 of 4 branches missed.">                if (heartRate &lt;=50 || heartRate &gt;= 100) {</span>
<span class="fc" id="L312">                    String id = String.valueOf(rec.getPatientId());</span>
<span class="fc" id="L313">                    Alert abnormalHeartRate = new Alert(id, rec.getRecordType(), rec.getTimestamp());</span>
<span class="fc" id="L314">                    triggerAlert(abnormalHeartRate);</span>
<span class="fc" id="L315">                    System.out.print(&quot;Abnormal heart rate alert&quot;);</span>
<span class="fc" id="L316">                    trigger=true;</span>
                }
            }
        }
<span class="fc" id="L320">        return trigger;</span>
    }

    /**
     * This method checks for irregular heartbeats in the patient's ECG readings
     * and triggers an alert if irregularities are detected.
     * @param patient
     */

    public boolean irregularBeat(Patient patient){

<span class="fc" id="L331">        PatientRecord pr=patient.patientRecords.get(0);</span>
<span class="fc" id="L332">        boolean trigger = false;</span>

<span class="fc bfc" id="L334" title="All 2 branches covered.">        for(int i=1; i&lt;patient.patientRecords.size(); i++) {</span>
<span class="fc" id="L335">            PatientRecord rec = patient.patientRecords.get(i);</span>

<span class="pc bpc" id="L337" title="1 of 2 branches missed.">            if (rec.getRecordType().equals(&quot;ECG&quot;)) {</span>

<span class="fc" id="L339">                double timeInterval=rec.getTimestamp()-pr.getTimestamp();</span>

<span class="fc bfc" id="L341" title="All 4 branches covered.">                if (timeInterval &lt;=24 || timeInterval &gt;= 62) {</span>
<span class="fc" id="L342">                    String id = String.valueOf(rec.getPatientId());</span>
<span class="fc" id="L343">                    Alert irregularBeat = new Alert(id, rec.getRecordType(), rec.getTimestamp());</span>
<span class="fc" id="L344">                    triggerAlert(irregularBeat);</span>
<span class="fc" id="L345">                    trigger=true;</span>
                }
            }
        }

<span class="fc" id="L350">        return trigger;</span>
    }

    /**
     * Triggers an alert for the monitoring system. This method can be extended to
     * notify medical staff, log the alert, or perform other actions. The method
     * currently assumes that the alert information is fully formed when passed as
     * an argument.
     *
     * @param alert the alert object containing details about the alert condition
     */
    private static void triggerAlert(Alert alert) {
        // Implementation might involve logging the alert or notifying staff
<span class="fc" id="L363">        System.out.print(&quot;Alert triggered: &quot; + alert.getCondition() + &quot; for patient &quot; + alert.getPatientId() + &quot;at&quot; + alert.getTimestamp());</span>
<span class="fc" id="L364">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>